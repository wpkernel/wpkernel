{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://wpkernel.org/schemas/wpk-config.schema.json",
	"title": "WPKernel Config",
	"description": "Configuration for the WPKernel CLI (wpk.config.ts). This file describes how your WordPress plugin is wired: namespace, shared schemas, resources with REST routes, storage in posts/taxonomies/options/transients, capabilities, and optional admin UI.",
	"type": "object",
	"required": ["version", "namespace", "schemas", "resources"],
	"additionalProperties": false,
	"properties": {
		"$schema": {
			"type": "string",
			"format": "uri",
			"description": "Optional JSON Schema URI used by editors and tooling. Ignored by WPKernel at runtime."
		},
		"version": {
			"const": 1,
			"description": "Configuration schema version. Must be set to 1 for this version of the WPKernel toolchain."
		},
		"namespace": {
			"type": "string",
			"pattern": "^[a-z][a-z0-9-]{2,49}$",
			"description": "Short, slug-style identifier for this plugin or feature. Used as a prefix for generated PHP namespaces, JS store keys, and WordPress capability names (for example, \"jobs\", \"catalog\", \"bookings\")."
		},
		"schemas": {
			"type": "object",
			"description": "Registry of shared schema descriptors, keyed by a short name. These are typically JSON Schema files that define request/response shapes for one or more resources.",
			"additionalProperties": { "$ref": "#/$defs/schemaConfig" }
		},
		"resources": {
			"type": "object",
			"description": "Registry of resource descriptors keyed by identifier. Each resource represents one WordPress-facing domain object (for example, a job listing, booking, or menu item) and drives REST routes, storage strategy (posts/taxonomies/options/transients), capabilities, and admin UI.",
			"additionalProperties": { "$ref": "#/$defs/resourceConfig" }
		},
		"adapters": {
			"type": "object",
			"description": "Optional adapter factories that customise the code WPKernel generates. These are advanced hooks for overriding low-level PHP/JS details rather than day-to-day plugin configuration.",
			"additionalProperties": true,
			"properties": {
				"php": {
					"$ref": "#/$defs/function",
					"description": "Factory that returns PHP codegen overrides (for example, changing namespaces or adding extra includes). Most plugins do not need this."
				},
				"extensions": {
					"type": "array",
					"description": "Adapter extension factories that run during generation to patch or extend the default adapters. Use this when you want to add custom behaviour without forking WPKernel itself.",
					"items": { "$ref": "#/$defs/function" }
				}
			}
		},
		"readiness": {
			"type": "object",
			"description": "Optional readiness helper factories that plug into the WPKernel \"doctor\" command. Use this to add custom health checks for your plugin or hosting environment.",
			"additionalProperties": false,
			"properties": {
				"helpers": {
					"type": "array",
					"description": "List of factories that WPKernel calls when building the readiness registry. Each factory can register one or more custom health checks.",
					"items": { "$ref": "#/$defs/function" }
				}
			}
		},
		"directories": {
			"type": "object",
			"description": "Optional mapping of applied artifact identifiers to workspace-relative directories (omit the \".applied\" suffix). Supported keys: blocks, blocks.applied, controllers, controllers.applied, plugin, plugin.loader.",
			"propertyNames": {
				"enum": [
					"blocks",
					"blocks.applied",
					"controllers",
					"controllers.applied",
					"plugin",
					"plugin.loader"
				]
			},
			"additionalProperties": {
				"type": "string",
				"minLength": 1
			}
		},
		"meta": {
			"$ref": "#/$defs/pluginMeta",
			"description": "Optional plugin metadata used for generated plugin headers. Defaults are derived from the namespace."
		}
	},
	"$defs": {
		"function": {
			"typeof": "function",
			"description": "Executable factory or callback. In practice this is a JavaScript/TypeScript function exported from your wpk.config.ts file."
		},
		"nonEmptyString": {
			"type": "string",
			"minLength": 1,
			"description": "A non-empty string."
		},
		"pluginMeta": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"name": {
					"type": "string",
					"minLength": 1,
					"description": "Human-readable plugin name shown in the WordPress plugin list. Defaults to the namespace in title case."
				},
				"description": {
					"type": "string",
					"minLength": 1,
					"description": "Short description visible in the WordPress plugin list."
				},
				"version": {
					"type": "string",
					"minLength": 1,
					"description": "Plugin version stamped into the generated loader."
				},
				"requiresAtLeast": {
					"type": "string",
					"minLength": 1,
					"description": "Minimum WordPress version required by the plugin."
				},
				"requiresPhp": {
					"type": "string",
					"minLength": 1,
					"description": "Minimum PHP version required by the plugin."
				},
				"textDomain": {
					"type": "string",
					"minLength": 1,
					"description": "Text domain used for translations. Defaults to the sanitized namespace."
				},
				"author": {
					"type": "string",
					"minLength": 1,
					"description": "Author shown in the plugin header."
				},
				"authorUri": {
					"type": "string",
					"minLength": 1,
					"description": "Optional author URL shown in the plugin header."
				},
				"pluginUri": {
					"type": "string",
					"minLength": 1,
					"description": "Optional plugin URL shown in the plugin header."
				},
				"license": {
					"type": "string",
					"minLength": 1,
					"description": "License identifier stamped into the plugin header."
				},
				"licenseUri": {
					"type": "string",
					"minLength": 1,
					"description": "Optional license URL stamped into the plugin header."
				}
			},
			"description": "WordPress plugin metadata used for generated plugin headers. When omitted, defaults are derived from the namespace."
		},
		"schemaConfig": {
			"type": "object",
			"required": ["path", "generated"],
			"additionalProperties": true,
			"properties": {
				"path": {
					"type": "string",
					"minLength": 1,
					"description": "Relative path (from the plugin root) to the source schema file (for example, a JSON Schema or Zod schema)."
				},
				"generated": {
					"type": "object",
					"required": ["types"],
					"additionalProperties": true,
					"properties": {
						"types": {
							"type": "string",
							"minLength": 1,
							"description": "Relative path where WPKernel should write the generated TypeScript types for this schema."
						}
					},
					"description": "Configuration for code that WPKernel generates from this schema, typically TypeScript types."
				},
				"description": {
					"type": "string",
					"minLength": 1,
					"description": "Human-readable description of what this schema models (for example, \"Public job listing API payload\")."
				}
			},
			"description": "Describes a single shared schema file and where its generated types should be written."
		},
		"resourceRoute": {
			"type": "object",
			"required": ["path", "method"],
			"additionalProperties": true,
			"properties": {
				"path": {
					"type": "string",
					"minLength": 1,
					"description": "REST API route path relative to the namespace (for example, \"/jobs\" or \"/jobs/(?P<id>\\\\d+)\")."
				},
				"method": {
					"enum": ["GET", "POST", "PUT", "PATCH", "DELETE"],
					"description": "HTTP method used for this route, matching how WordPress registers REST endpoints."
				},
				"capability": {
					"type": "string",
					"minLength": 1,
					"description": "WordPress capability string required to call this route (for example, \"jobs_read\" or \"manage_options\"). If omitted, WPKernel falls back to the resource-level capabilities."
				}
			},
			"description": "Definition for a single REST API endpoint that WPKernel will register via WordPress's REST API."
		},
		"resourceRoutes": {
			"type": "object",
			"minProperties": 1,
			"properties": {
				"list": { "$ref": "#/$defs/resourceRoute" },
				"get": { "$ref": "#/$defs/resourceRoute" },
				"create": { "$ref": "#/$defs/resourceRoute" },
				"update": { "$ref": "#/$defs/resourceRoute" },
				"remove": { "$ref": "#/$defs/resourceRoute" }
			},
			"additionalProperties": { "$ref": "#/$defs/resourceRoute" },
			"description": "Named REST routes for the resource. Common operations like list/get/create/update/remove map to typical CRUD endpoints, and you can also define extra routes by name."
		},
		"resourceIdentityNumber": {
			"type": "object",
			"required": ["type"],
			"additionalProperties": true,
			"properties": {
				"type": {
					"const": "number",
					"description": "Numeric identity for this resource, usually a WordPress post ID."
				},
				"param": {
					"enum": ["id"],
					"description": "Name of the route parameter that carries the numeric ID. For WordPress posts this is almost always \"id\"."
				}
			},
			"description": "Identity configuration for resources addressed by numeric IDs (for example, WP posts)."
		},
		"resourceIdentityString": {
			"type": "object",
			"required": ["type"],
			"additionalProperties": true,
			"properties": {
				"type": {
					"const": "string",
					"description": "String identity for this resource, such as a slug or UUID."
				},
				"param": {
					"enum": ["id", "slug", "uuid"],
					"description": "Name of the route parameter used to look up the resource (for example, \"slug\" for custom post types that are addressed by slug)."
				}
			},
			"description": "Identity configuration for resources addressed by string keys (slugs, UUIDs, etc.)."
		},
		"resourceIdentity": {
			"oneOf": [
				{ "$ref": "#/$defs/resourceIdentityNumber" },
				{ "$ref": "#/$defs/resourceIdentityString" }
			],
			"description": "How this resource is uniquely identified in REST routes and storage: by numeric ID (post ID) or by a string key (slug/UUID)."
		},
		"resourceStorageTransient": {
			"type": "object",
			"required": ["mode"],
			"additionalProperties": true,
			"properties": {
				"mode": {
					"const": "transient",
					"description": "Store data in WordPress transients rather than posts/taxonomies/options. Best for short-lived or cache-like data."
				}
			},
			"description": "Configuration for resources that are stored entirely in WordPress transients."
		},
		"resourceStoragePostMeta": {
			"type": "object",
			"required": ["type"],
			"additionalProperties": true,
			"properties": {
				"type": {
					"enum": [
						"string",
						"integer",
						"number",
						"boolean",
						"array",
						"object"
					],
					"description": "PHP value type stored in post meta for this field."
				},
				"single": {
					"type": "boolean",
					"description": "Whether this meta key stores a single value (true) or multiple values (false), mirroring the $single flag in get_post_meta()."
				}
			},
			"description": "Shape of a single post meta field used by the resource's storage."
		},
		"resourceStoragePostTaxonomy": {
			"type": "object",
			"required": ["taxonomy"],
			"additionalProperties": true,
			"properties": {
				"taxonomy": {
					"type": "string",
					"minLength": 1,
					"description": "Taxonomy slug (for example, \"category\", \"post_tag\", or a custom taxonomy)."
				},
				"hierarchical": {
					"type": "boolean",
					"description": "Whether the taxonomy behaves like categories (true) or tags (false)."
				},
				"register": {
					"type": "boolean",
					"description": "If true, WPKernel will register this taxonomy for you when generating the plugin."
				}
			},
			"description": "Configuration describing a taxonomy relationship on a post-based resource."
		},
		"resourceStoragePost": {
			"type": "object",
			"required": ["mode"],
			"additionalProperties": true,
			"properties": {
				"mode": {
					"const": "wp-post",
					"description": "Indicates that this resource is stored as a WordPress post type."
				},
				"postType": {
					"type": "string",
					"minLength": 1,
					"description": "Custom post type slug to use for this resource."
				},
				"statuses": {
					"type": "array",
					"items": { "type": "string", "minLength": 1 },
					"description": "Allowed post statuses for this resource (for example, [\"publish\", \"draft\"])."
				},
				"supports": {
					"type": "array",
					"items": {
						"enum": ["title", "editor", "excerpt", "custom-fields"]
					},
					"description": "Core WordPress features to enable for the post type, mirroring the `supports` argument in register_post_type()."
				},
				"meta": {
					"type": "object",
					"additionalProperties": {
						"$ref": "#/$defs/resourceStoragePostMeta"
					},
					"description": "Map of meta keys to their storage configuration for this post type."
				},
				"taxonomies": {
					"type": "object",
					"additionalProperties": {
						"$ref": "#/$defs/resourceStoragePostTaxonomy"
					},
					"description": "Map of taxonomy slugs to their configuration for this post type."
				}
			},
			"description": "Configuration for resources modelled as custom post types in WordPress."
		},
		"resourceStorageTaxonomy": {
			"type": "object",
			"required": ["mode", "taxonomy"],
			"additionalProperties": true,
			"properties": {
				"mode": {
					"const": "wp-taxonomy",
					"description": "Indicates that this resource is stored as a WordPress taxonomy term."
				},
				"taxonomy": {
					"type": "string",
					"minLength": 1,
					"description": "Taxonomy slug used to store this resource (for example, \"category\" or a custom taxonomy)."
				},
				"hierarchical": {
					"type": "boolean",
					"description": "Whether the taxonomy is hierarchical (like categories) or flat (like tags)."
				}
			},
			"description": "Configuration for resources stored as taxonomy terms."
		},
		"resourceStorageOption": {
			"type": "object",
			"required": ["mode", "option"],
			"additionalProperties": true,
			"properties": {
				"mode": {
					"const": "wp-option",
					"description": "Indicates that this resource is stored in the WordPress options table."
				},
				"option": {
					"type": "string",
					"minLength": 1,
					"description": "Option name used to store this resource."
				}
			},
			"description": "Configuration for resources stored in the WordPress options table."
		},
		"resourceStorage": {
			"oneOf": [
				{ "$ref": "#/$defs/resourceStorageTransient" },
				{ "$ref": "#/$defs/resourceStoragePost" },
				{ "$ref": "#/$defs/resourceStorageTaxonomy" },
				{ "$ref": "#/$defs/resourceStorageOption" }
			],
			"description": "Where WordPress will actually store data for this resource: transients, posts, taxonomies, or options."
		},
		"resourceCapabilityDescriptor": {
			"type": "object",
			"required": ["capability", "appliesTo"],
			"additionalProperties": true,
			"properties": {
				"capability": {
					"type": "string",
					"minLength": 1,
					"description": "Full WordPress capability name (for example, \"jobs_read\" or \"jobs_edit_own\"). WPKernel will generate helpers that reference this capability."
				},
				"appliesTo": {
					"enum": ["resource", "object"],
					"description": "Whether this capability is checked at the collection level (\"resource\", for example \"can list jobs\") or per-object (\"object\", for example \"can edit this specific job\")."
				},
				"binding": {
					"type": "string",
					"minLength": 1,
					"description": "Optional key describing how this capability binds to WordPress (for example, a meta capability mapping). This is mainly for advanced capability setups."
				}
			},
			"description": "Detailed capability configuration for a single operation, mapping your resource permissions onto WordPress's capability system."
		},
		"resourceCapabilities": {
			"type": "object",
			"additionalProperties": {
				"oneOf": [
					{ "type": "string", "minLength": 1 },
					{ "$ref": "#/$defs/resourceCapabilityDescriptor" }
				]
			},
			"description": "Map of operation keys (for example, \"list\", \"get\", \"create\", \"update\", \"remove\") to the WordPress capabilities required to perform them. Each entry can be a simple capability string or a detailed descriptor."
		},
		"resourceQueryParamDescriptor": {
			"type": "object",
			"required": ["type"],
			"additionalProperties": false,
			"properties": {
				"type": {
					"enum": ["string", "enum"],
					"description": "Base type of the query parameter. \"enum\" indicates that the parameter must be one of a fixed set of string values."
				},
				"optional": {
					"type": "boolean",
					"description": "Whether this query parameter is optional."
				},
				"enum": {
					"type": "array",
					"items": { "type": "string", "minLength": 1 },
					"description": "Allowed values when type is \"enum\"."
				},
				"description": {
					"type": "string",
					"minLength": 1,
					"description": "Human-readable explanation of how this query parameter is used (for example, \"Filter jobs by status\")."
				}
			},
			"description": "Descriptor for a single query parameter accepted by this resource's REST API routes."
		},
		"resourceQueryParams": {
			"type": "object",
			"additionalProperties": {
				"$ref": "#/$defs/resourceQueryParamDescriptor"
			},
			"description": "Map of query parameter names to their descriptors, defining the supported query-string filters for this resource."
		},
		"resourceAdminUI": {
			"type": "object",
			"additionalProperties": true,
			"properties": {
				"view": {
					"type": "string",
					"minLength": 1,
					"description": "Selects the generated admin surface. Use \"dataviews\" to opt into the inferred DataViews UI; other values are reserved."
				},
				"menu": {
					"type": "object",
					"additionalProperties": true,
					"properties": {
						"slug": {
							"$ref": "#/$defs/nonEmptyString",
							"description": "Menu slug used when registering the admin page for this resource."
						},
						"title": {
							"$ref": "#/$defs/nonEmptyString",
							"description": "Menu title shown in the WordPress admin sidebar."
						},
						"capability": {
							"type": "string",
							"minLength": 1,
							"description": "Capability required to see this admin menu (for example, \"manage_options\" or a resource-specific capability)."
						},
						"parent": {
							"type": "string",
							"minLength": 1,
							"description": "Parent menu slug if this screen should live under an existing menu (for example, \"options-general.php\")."
						},
						"position": {
							"type": "number",
							"description": "Numeric menu position, following WordPress's admin menu conventions."
						}
					},
					"description": "Optional menu configuration for the admin screen. Unlike other UI pieces, menu registration is explicit."
				}
			},
			"description": "Shallow admin UI configuration. Detailed DataViews wiring is inferred from schemas, storage, and layout manifests."
		},
		"resourceUI": {
			"type": "object",
			"additionalProperties": true,
			"properties": {
				"admin": {
					"$ref": "#/$defs/resourceAdminUI",
					"description": "Optional admin UI hint. When set, WPKernel derives the screen, menu, and fixtures automatically."
				}
			},
			"description": "UI configuration for the resource. Most projects only set `admin.view: \"dataviews\"` and rely on inference."
		},
		"resourceConfig": {
			"type": "object",
			"required": ["routes"],
			"additionalProperties": true,
			"properties": {
				"name": {
					"type": "string",
					"minLength": 1,
					"description": "Optional human-readable name for this resource (for example, \"Job\" or \"Booking\"). If omitted, WPKernel uses the resource key instead."
				},
				"namespace": {
					"type": "string",
					"minLength": 1,
					"description": "Optional override for the REST namespace segment for this resource. Defaults to the top-level namespace if omitted."
				},
				"routes": {
					"$ref": "#/$defs/resourceRoutes",
					"description": "REST API routes that expose this resource via WordPress's REST API."
				},
				"identity": {
					"$ref": "#/$defs/resourceIdentity",
					"description": "How this resource is identified in URLs and storage (post ID, slug, UUID, etc.)."
				},
				"storage": {
					"$ref": "#/$defs/resourceStorage",
					"description": "Where and how WordPress stores this resource's data (posts, taxonomies, options, transients)."
				},
				"queryParams": {
					"$ref": "#/$defs/resourceQueryParams",
					"description": "Query-string parameters that can be used when calling this resource's REST routes."
				},
				"schema": {
					"anyOf": [
						{ "type": "string", "minLength": 1 },
						{ "type": "object", "additionalProperties": true }
					],
					"description": "Schema for the resource's data. Provide a reference to a shared schema key or an inline schema object."
				},
				"ui": {
					"$ref": "#/$defs/resourceUI",
					"description": "UI configuration, primarily for the WordPress admin, associated with this resource. Detailed DataViews descriptors are no longer authored here; they are inferred from your schemas, storage, and layout manifest."
				},
				"blocks": {
					"$ref": "#/$defs/resourceBlocksConfig",
					"description": "Optional Gutenberg block configuration for this resource. Set `mode: \"ssr\"` to generate server-rendered blocks with PHP registrars; omit or set `mode: \"js\"` to keep the default JS-only blocks."
				},
				"capabilities": {
					"$ref": "#/$defs/resourceCapabilities",
					"description": "Mapping between high-level operations on this resource and the WordPress capabilities that guard them. This is where you connect your domain permissions to WordPress's capability system."
				}
			},
			"description": "Defines a single resource exposed by your plugin: its name, REST routes, WordPress storage strategy, capabilities, and optional admin UI."
		},
		"resourceBlocksConfig": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"mode": {
					"type": "string",
					"enum": ["js", "ssr"],
					"default": "js",
					"description": "Controls whether the CLI emits JS-only blocks (`\"js\"`, default) or full SSR-ready blocks with PHP render callbacks (`\"ssr\"`)."
				}
			},
			"description": "Optional per-resource control over generated Gutenberg blocks. Use `mode: \"ssr\"` when the block must render HTML on the server (SEO, email, non-JS clients)."
		}
	}
}
